#!/usr/bin/env python3
"""
ì „êµ­ ë™ë‹¨ìœ„ ì™„ì „ í¬ë¡¤ë§ ì‹œìŠ¤í…œ
- ì „êµ­ ëª¨ë“  ì‹œ/êµ¬/ë™ ì„¸ë¶„í™” í¬ë¡¤ë§
- ëª¨ë“  ê±°ë˜ íƒ€ì… í¬í•¨ (ë§¤ë§¤+ì „ì„¸+ì›”ì„¸)
- IP ì°¨ë‹¨ ë°©ì§€ ì‹œìŠ¤í…œ
- ëŒ€ìš©ëŸ‰ ë°ì´í„° ì²˜ë¦¬ ìµœì í™”
- ìë™ ì¬ì‹œë„ ë° ë³µêµ¬ ì‹œìŠ¤í…œ
"""

import asyncio
import aiohttp
import sqlite3
import json
import time
import random
from datetime import datetime
from typing import List, Dict, Optional, Tuple
from urllib.parse import urlencode
import logging
import sys
import os

# ë¡œê¹… ì„¤ì • (ë¨¼ì € ì„¤ì •)
logging.basicConfig(
    level=logging.INFO,
    format='%(asctime)s - %(levelname)s - %(message)s',
    handlers=[
        logging.FileHandler('nationwide_dong_crawling.log', encoding='utf-8'),
        logging.StreamHandler()
    ]
)
logger = logging.getLogger(__name__)

# VPN ë§¤ë‹ˆì € importë¥¼ ìœ„í•œ ê²½ë¡œ ì¶”ê°€
sys.path.append(os.path.join(os.path.dirname(__file__), 'modules', 'naver-crawler'))

try:
    from utils.vpn_manager import VPNManager, ensure_safe_connection, handle_ip_blocked
    VPN_AVAILABLE = True
    logger.info("âœ… VPN ë°±ì—… ì‹œìŠ¤í…œ ì‚¬ìš© ê°€ëŠ¥")
except ImportError as e:
    VPN_AVAILABLE = False
    logger.warning(f"âš ï¸ VPN ë§¤ë‹ˆì € import ì‹¤íŒ¨: {e}")
    logger.warning("âš ï¸ VPN ì—†ì´ ì§„í–‰í•©ë‹ˆë‹¤")

class NationwideDongCrawler:
    def __init__(self, db_path="real_estate_crawling.db"):
        self.db_path = db_path
        self.base_url = "https://new.land.naver.com/api/complexes/single-markers/2.0"
        self.session = None
        self.vpn_manager = VPNManager() if VPN_AVAILABLE else None
        self.blocked_count = 0  # ì°¨ë‹¨ íšŸìˆ˜ ì¶”ì 
        self.max_blocked_attempts = 3  # ìµœëŒ€ ì°¨ë‹¨ í—ˆìš© íšŸìˆ˜
        self.init_database()
        
    def init_database(self):
        """ë°ì´í„°ë² ì´ìŠ¤ ì´ˆê¸°í™” - ìƒì„¸í•œ ìŠ¤í‚¤ë§ˆ"""
        conn = sqlite3.connect(self.db_path)
        cursor = conn.cursor()
        
        # ê¸°ì¡´ í…Œì´ë¸” ì‚­ì œí•˜ê³  ìƒˆë¡œìš´ êµ¬ì¡°ë¡œ ìƒì„±
        cursor.execute('DROP TABLE IF EXISTS apartment_complexes')
        cursor.execute('DROP TABLE IF EXISTS crawling_progress')
        
        # ìƒˆë¡œìš´ ìƒì„¸ ì•„íŒŒíŠ¸ í…Œì´ë¸”
        cursor.execute('''
            CREATE TABLE apartment_complexes (
                id INTEGER PRIMARY KEY AUTOINCREMENT,
                complex_id TEXT UNIQUE NOT NULL,
                complex_name TEXT NOT NULL,
                city TEXT NOT NULL,
                gu TEXT NOT NULL,
                dong TEXT NOT NULL,
                address_road TEXT,
                address_jibun TEXT,
                latitude REAL,
                longitude REAL,
                total_units INTEGER,
                construction_year INTEGER,
                
                -- ë§¤ë§¤ ê°€ê²© (ë§Œì›)
                deal_min_price INTEGER,
                deal_max_price INTEGER,
                deal_count INTEGER DEFAULT 0,
                
                -- ì „ì„¸ ê°€ê²© (ë§Œì›)
                lease_min_price INTEGER,
                lease_max_price INTEGER,
                lease_count INTEGER DEFAULT 0,
                
                -- ì›”ì„¸ ê°€ê²© (ë§Œì›)
                rent_min_price INTEGER,
                rent_max_price INTEGER,
                rent_min_deposit INTEGER,
                rent_max_deposit INTEGER,
                rent_count INTEGER DEFAULT 0,
                
                -- ë©´ì  ì •ë³´ (ã¡)
                min_area REAL,
                max_area REAL,
                representative_area REAL,
                
                -- ë©”íƒ€ ì •ë³´
                real_estate_type TEXT,
                trade_types TEXT,  -- ë§¤ë§¤,ì „ì„¸,ì›”ì„¸ ì¤‘ ì–´ë–¤ ê±°ë˜ê°€ ìˆëŠ”ì§€
                source_url TEXT,
                created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
                updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
                
                -- ì›ë³¸ ë°ì´í„°
                raw_data TEXT
            )
        ''')
        
        # í¬ë¡¤ë§ ì§„í–‰ ìƒí™© í…Œì´ë¸”
        cursor.execute('''
            CREATE TABLE crawling_progress (
                id INTEGER PRIMARY KEY AUTOINCREMENT,
                city TEXT,
                gu TEXT,  
                dong TEXT,
                trade_type TEXT,
                status TEXT,  -- pending, processing, completed, failed, skipped
                apartment_count INTEGER DEFAULT 0,
                crawl_start_time TIMESTAMP,
                crawl_end_time TIMESTAMP,
                error_message TEXT,
                retry_count INTEGER DEFAULT 0
            )
        ''')
        
        # ì¸ë±ìŠ¤ ìƒì„±
        cursor.execute('CREATE INDEX IF NOT EXISTS idx_complex_id ON apartment_complexes(complex_id)')
        cursor.execute('CREATE INDEX IF NOT EXISTS idx_location ON apartment_complexes(city, gu, dong)')
        cursor.execute('CREATE INDEX IF NOT EXISTS idx_progress ON crawling_progress(city, gu, dong, trade_type)')
        
        conn.commit()
        conn.close()
        logger.info("âœ… ìƒˆë¡œìš´ ìƒì„¸ ë°ì´í„°ë² ì´ìŠ¤ êµ¬ì¡° ì´ˆê¸°í™” ì™„ë£Œ")

    async def init_session(self):
        """HTTP ì„¸ì…˜ ì´ˆê¸°í™” + VPN ì—°ê²° í™•ì¸"""
        # VPN ë°±ì—… ì‹œìŠ¤í…œìœ¼ë¡œ ì•ˆì „í•œ ì—°ê²° ë³´ì¥
        if VPN_AVAILABLE and self.vpn_manager:
            try:
                logger.info("ğŸ” VPN ë°±ì—… ì‹œìŠ¤í…œìœ¼ë¡œ ì•ˆì „í•œ ì—°ê²° í™•ì¸ ì¤‘...")
                success, ip, vpn_type = await ensure_safe_connection()
                
                if success:
                    logger.info(f"âœ… {vpn_type} ì—°ê²° ì„±ê³µ - IP: {ip}")
                    self.current_vpn = vpn_type
                    self.current_ip = ip
                else:
                    logger.warning("âš ï¸ VPN ì—°ê²° ì‹¤íŒ¨, ì¼ë°˜ ì—°ê²°ë¡œ ì§„í–‰")
                    self.current_vpn = "None"
                    self.current_ip = "Unknown"
            except Exception as e:
                logger.error(f"âŒ VPN ì‹œìŠ¤í…œ ì˜¤ë¥˜: {e}")
                logger.warning("âš ï¸ VPN ì—†ì´ ì§„í–‰í•©ë‹ˆë‹¤")
                self.current_vpn = "None"
                self.current_ip = "Unknown"
        else:
            logger.info("â„¹ï¸ VPN ì‹œìŠ¤í…œ ì—†ì´ ì§„í–‰")
            self.current_vpn = "None"
            self.current_ip = "Unknown"
        
        headers = {
            'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/120.0.0.0 Safari/537.36',
            'Accept': 'application/json, text/plain, */*',
            'Accept-Language': 'ko-KR,ko;q=0.9,en;q=0.8',
            'Referer': 'https://new.land.naver.com/',
            'Origin': 'https://new.land.naver.com',
            'Accept-Encoding': 'gzip, deflate, br',
            'Connection': 'keep-alive',
            'Sec-Fetch-Dest': 'empty',
            'Sec-Fetch-Mode': 'cors',
            'Sec-Fetch-Site': 'same-origin',
            'Cache-Control': 'no-cache',
            'Pragma': 'no-cache'
        }
        
        timeout = aiohttp.ClientTimeout(total=60)
        self.session = aiohttp.ClientSession(headers=headers, timeout=timeout)
        
    async def close_session(self):
        """HTTP ì„¸ì…˜ ì¢…ë£Œ"""
        if self.session:
            await self.session.close()

    def get_nationwide_regions(self) -> Dict[str, Dict[str, List[Tuple[str, str]]]]:
        """ì „êµ­ ì‹œ/êµ¬/ë™ ì¢Œí‘œ ë°ì´í„°"""
        return {
            "ì„œìš¸": {
                "ê°•ë‚¨êµ¬": [
                    ("ì‹ ì‚¬ë™", "1168010500"),
                    ("ë…¼í˜„ë™", "1168010500"),
                    ("ì••êµ¬ì •ë™", "1168010500"),
                    ("ì²­ë‹´ë™", "1168010500"),
                    ("ì‚¼ì„±ë™", "1168010500"),
                    ("ëŒ€ì¹˜ë™", "1168010500"),
                    ("ì—­ì‚¼ë™", "1168010500"),
                    ("ë„ê³¡ë™", "1168010500"),
                    ("ê°œí¬ë™", "1168010500"),
                    ("ì„¸ê³¡ë™", "1168010500"),
                    ("ìê³¡ë™", "1168010500"),
                    ("ìœ¨í˜„ë™", "1168010500"),
                    ("ì¼ì›ë™", "1168010500"),
                    ("ìˆ˜ì„œë™", "1168010500")
                ],
                "ì„œì´ˆêµ¬": [
                    ("ì„œì´ˆë™", "1168011900"),
                    ("ì ì›ë™", "1168011900"),
                    ("ë°˜í¬ë™", "1168011900"),
                    ("ë°©ë°°ë™", "1168011900"),
                    ("ì–‘ì¬ë™", "1168011900"),
                    ("ë‚´ê³¡ë™", "1168011900"),
                    ("ì—¼ê³¡ë™", "1168011900"),
                    ("ì›ì§€ë™", "1168011900"),
                    ("ìš°ë©´ë™", "1168011900")
                ],
                "ì†¡íŒŒêµ¬": [
                    ("ê°€ë½ë™", "1168012200"),
                    ("ê±°ì—¬ë™", "1168012200"),
                    ("ë§ˆì²œë™", "1168012200"),
                    ("ë¬¸ì •ë™", "1168012200"),
                    ("ë°©ì´ë™", "1168012200"),
                    ("ì‚¼ì „ë™", "1168012200"),
                    ("ì„ì´Œë™", "1168012200"),
                    ("ì†¡íŒŒë™", "1168012200"),
                    ("ì‹ ì²œë™", "1168012200"),
                    ("ì˜¤ê¸ˆë™", "1168012200"),
                    ("ì˜¤ë¥œë™", "1168012200"),
                    ("ì ì‹¤ë™", "1168012200"),
                    ("ì¥ì§€ë™", "1168012200"),
                    ("í’ë‚©ë™", "1168012200")
                ],
                "ê°•ë™êµ¬": [
                    ("ê°•ì¼ë™", "1168010600"),
                    ("ê³ ë•ë™", "1168010600"),
                    ("ê¸¸ë™", "1168010600"),
                    ("ë‘”ì´Œë™", "1168010600"),
                    ("ëª…ì¼ë™", "1168010600"),
                    ("ìƒì¼ë™", "1168010600"),
                    ("ì„±ë‚´ë™", "1168010600"),
                    ("ì•”ì‚¬ë™", "1168010600"),
                    ("ì²œí˜¸ë™", "1168010600")
                ],
                "ë§ˆí¬êµ¬": [
                    ("ê³µë•ë™", "1168011700"),
                    ("êµ¬ìˆ˜ë™", "1168011700"),
                    ("ë…¸ê³ ì‚°ë™", "1168011700"),
                    ("ëŒ€í¥ë™", "1168011700"),
                    ("ë„í™”ë™", "1168011700"),
                    ("ë™êµë™", "1168011700"),
                    ("ë§ˆí¬ë™", "1168011700"),
                    ("ë§ì›ë™", "1168011700"),
                    ("ìƒì•”ë™", "1168011700"),
                    ("ìƒìˆ˜ë™", "1168011700"),
                    ("ì„œêµë™", "1168011700"),
                    ("ì„±ì‚°ë™", "1168011700"),
                    ("ì‹ ê³µë•ë™", "1168011700"),
                    ("ì•„í˜„ë™", "1168011700"),
                    ("ì—°ë‚¨ë™", "1168011700"),
                    ("ì—¼ë¦¬ë™", "1168011700"),
                    ("ìš©ê°•ë™", "1168011700"),
                    ("í† ì •ë™", "1168011700"),
                    ("í•˜ì¤‘ë™", "1168011700"),
                    ("í•©ì •ë™", "1168011700"),
                    ("í˜„ì„ë™", "1168011700")
                ],
                # 2ë‹¨ê³„ í™•ì¥: ì„œìš¸ ë‚˜ë¨¸ì§€ 20ê°œêµ¬ ì¶”ê°€
                "ì¢…ë¡œêµ¬": [
                    ("ì²­ìš´ë™", "1111010300"),
                    ("ì‹ êµë™", "1111010300"),
                    ("ê¶ì •ë™", "1111010300"),
                    ("íš¨ìë™", "1111010300"),
                    ("ì°½ì„±ë™", "1111010300"),
                    ("í†µì˜ë™", "1111010300"),
                    ("ì ì„ ë™", "1111010300"),
                    ("í†µì¸ë™", "1111010300"),
                    ("ëˆ„ìƒë™", "1111010300"),
                    ("ëˆ„í•˜ë™", "1111010300"),
                    ("ì˜¥ì¸ë™", "1111010300"),
                    ("ì²´ë¶€ë™", "1111010300"),
                    ("í•„ìš´ë™", "1111010300"),
                    ("ë‚´ìë™", "1111010300"),
                    ("ì‚¬ì§ë™", "1111010300"),
                    ("ë„ë ´ë™", "1111010300"),
                    ("ë‹¹ì£¼ë™", "1111010300"),
                    ("ë‚´ìˆ˜ë™", "1111010300"),
                    ("ì„¸ì¢…ë¡œ", "1111010300"),
                    ("ì¢…ë¡œ1ê°€", "1111010300"),
                    ("ì¢…ë¡œ2ê°€", "1111010300"),
                    ("ì¢…ë¡œ3ê°€", "1111010300"),
                    ("ì¢…ë¡œ4ê°€", "1111010300"),
                    ("ì¢…ë¡œ5ê°€", "1111010300"),
                    ("ì¢…ë¡œ6ê°€", "1111010300"),
                    ("ì´í™”ë™", "1111010300"),
                    ("í˜œí™”ë™", "1111010300"),
                    ("ëª…ë¥œ1ê°€", "1111010300"),
                    ("ëª…ë¥œ2ê°€", "1111010300"),
                    ("ëª…ë¥œ3ê°€", "1111010300"),
                    ("ëª…ë¥œ4ê°€", "1111010300"),
                    ("ì°½ì‹ ë™", "1111010300"),
                    ("ìˆ­ì¸ë™", "1111010300")
                ],
                "ì¤‘êµ¬": [
                    ("ì†Œê³µë™", "1114010700"),
                    ("íšŒí˜„ë™1ê°€", "1114010700"),
                    ("íšŒí˜„ë™2ê°€", "1114010700"),
                    ("íšŒí˜„ë™3ê°€", "1114010700"),
                    ("ëª…ë™1ê°€", "1114010700"),
                    ("ëª…ë™2ê°€", "1114010700"),
                    ("í•„ë™1ê°€", "1114010700"),
                    ("í•„ë™2ê°€", "1114010700"),
                    ("í•„ë™3ê°€", "1114010700"),
                    ("ë‚¨ì‚°ë™1ê°€", "1114010700"),
                    ("ë‚¨ì‚°ë™2ê°€", "1114010700"),
                    ("ë‚¨ì‚°ë™3ê°€", "1114010700"),
                    ("ì²­êµ¬ë™", "1114010700"),
                    ("ì‹ ë‹¹ë™", "1114010700"),
                    ("ë‹¤ì‚°ë™", "1114010700"),
                    ("ì•½ìˆ˜ë™", "1114010700"),
                    ("ì²­íŒŒë™1ê°€", "1114010700"),
                    ("ì²­íŒŒë™2ê°€", "1114010700"),
                    ("ì²­íŒŒë™3ê°€", "1114010700"),
                    ("ì›íš¨ë¡œ1ê°€", "1114010700"),
                    ("ì›íš¨ë¡œ2ê°€", "1114010700"),
                    ("ì›íš¨ë¡œ3ê°€", "1114010700"),
                    ("ì›íš¨ë¡œ4ê°€", "1114010700"),
                    ("íš¨ì°½ë™", "1114010700"),
                    ("ìš©ì‚°ë™1ê°€", "1114010700"),
                    ("ìš©ì‚°ë™2ê°€", "1114010700"),
                    ("ìš©ì‚°ë™3ê°€", "1114010700"),
                    ("ìš©ì‚°ë™4ê°€", "1114010700"),
                    ("ìš©ì‚°ë™5ê°€", "1114010700"),
                    ("ìš©ì‚°ë™6ê°€", "1114010700"),
                    ("í•œê°•ë¡œ1ê°€", "1114010700"),
                    ("í•œê°•ë¡œ2ê°€", "1114010700"),
                    ("í•œê°•ë¡œ3ê°€", "1114010700"),
                    ("ì´ì´Œë™", "1114010700"),
                    ("ì´íƒœì›ë™", "1114010700"),
                    ("í•œë‚¨ë™", "1114010700"),
                    ("ë™ë¹™ê³ ë™", "1114010700"),
                    ("ì„œë¹™ê³ ë™", "1114010700")
                ],
                "ìš©ì‚°êµ¬": [
                    ("í›„ì•”ë™", "1117010300"),
                    ("ìš©ì‚°ë™2ê°€", "1117010300"),
                    ("ìš©ì‚°ë™4ê°€", "1117010300"),
                    ("ê°ˆì›”ë™", "1117010300"),
                    ("ì˜ë“±í¬ë™", "1117010300"),
                    ("ì‹ ê¸¸ë™", "1117010300"),
                    ("ëŒ€ë¦¼ë™", "1117010300"),
                    ("ë„ë¦¼ë™", "1117010300"),
                    ("ë¬¸ë˜ë™", "1117010300"),
                    ("ì–‘í‰ë™", "1117010300"),
                    ("ì„ ìœ ë™", "1117010300"),
                    ("ì—¬ì˜ë„ë™", "1117010300"),
                    ("ë‹¹ì‚°ë™", "1117010300")
                ],
                "ì„±ë™êµ¬": [
                    ("ì™•ì‹­ë¦¬ë™", "1120010300"),
                    ("ë§ˆì¥ë™", "1120010300"),
                    ("ì‚¬ê·¼ë™", "1120010300"),
                    ("í–‰ë‹¹ë™", "1120010300"),
                    ("ì‘ë´‰ë™", "1120010300"),
                    ("ê¸ˆêµë™", "1120010300"),
                    ("ì˜¥ìˆ˜ë™", "1120010300"),
                    ("ì„±ìˆ˜ë™1ê°€", "1120010300"),
                    ("ì„±ìˆ˜ë™2ê°€", "1120010300"),
                    ("ì†¡ì •ë™", "1120010300"),
                    ("ìš©ë‹µë™", "1120010300")
                ],
                "ê´‘ì§„êµ¬": [
                    ("ì¤‘ê³¡ë™", "1121010300"),
                    ("ëŠ¥ë™", "1121010300"),
                    ("êµ¬ì˜ë™", "1121010300"),
                    ("ìì–‘ë™", "1121010300"),
                    ("í™”ì–‘ë™", "1121010300"),
                    ("êµ°ìë™", "1121010300")
                ],
                "ë™ëŒ€ë¬¸êµ¬": [
                    ("ìš©ì‹ ë™", "1123010300"),
                    ("ì œê¸°ë™", "1123010300"),
                    ("ì „ë†ë™", "1123010300"),
                    ("ë‹µì‹­ë¦¬ë™", "1123010300"),
                    ("ì¥ì•ˆë™", "1123010300"),
                    ("ì²­ëŸ‰ë¦¬ë™", "1123010300"),
                    ("íšŒê¸°ë™", "1123010300"),
                    ("íœ˜ê²½ë™", "1123010300"),
                    ("ì´ë¬¸ë™", "1123010300")
                ],
                "ì¤‘ë‘êµ¬": [
                    ("ë©´ëª©ë™", "1124010300"),
                    ("ìƒë´‰ë™", "1124010300"),
                    ("ì¤‘í™”ë™", "1124010300"),
                    ("ë¬µë™", "1124010300"),
                    ("ë§ìš°ë™", "1124010300"),
                    ("ì‹ ë‚´ë™", "1124010300")
                ],
                "ì„±ë¶êµ¬": [
                    ("ì„±ë¶ë™", "1129010300"),
                    ("ì‚¼ì„ ë™", "1129010300"),
                    ("ë™ì„ ë™", "1129010300"),
                    ("ëˆì•”ë™", "1129010300"),
                    ("ì•ˆì•”ë™", "1129010300"),
                    ("ë³´ë¬¸ë™", "1129010300"),
                    ("ì •ë¦‰ë™", "1129010300"),
                    ("ê¸¸ìŒë™", "1129010300"),
                    ("ì¢…ì•”ë™", "1129010300"),
                    ("ì›”ê³¡ë™", "1129010300"),
                    ("ì¥ìœ„ë™", "1129010300"),
                    ("ì„ê´€ë™", "1129010300")
                ],
                "ê°•ë¶êµ¬": [
                    ("ì‚¼ì–‘ë™", "1130510300"),
                    ("ë¯¸ì•„ë™", "1130510300"),
                    ("ë²ˆë™", "1130510300"),
                    ("ìˆ˜ìœ ë™", "1130510300"),
                    ("ìš°ì´ë™", "1130510300")
                ],
                "ë„ë´‰êµ¬": [
                    ("ìŒë¬¸ë™", "1131010300"),
                    ("ë°©í•™ë™", "1131010300"),
                    ("ì°½ë™", "1131010300"),
                    ("ë„ë´‰ë™", "1131010300")
                ],
                "ë…¸ì›êµ¬": [
                    ("ì›”ê³„ë™", "1135010300"),
                    ("ê³µë¦‰ë™", "1135010300"),
                    ("í•˜ê³„ë™", "1135010300"),
                    ("ì¤‘ê³„ë™", "1135010300"),
                    ("ìƒê³„ë™", "1135010300")
                ],
                "ì€í‰êµ¬": [
                    ("ë…¹ë²ˆë™", "1141010300"),
                    ("ë¶ˆê´‘ë™", "1141010300"),
                    ("ê°ˆí˜„ë™", "1141010300"),
                    ("êµ¬ì‚°ë™", "1141010300"),
                    ("ëŒ€ì¡°ë™", "1141010300"),
                    ("ì‘ì•”ë™", "1141010300"),
                    ("ì—­ì´Œë™", "1141010300"),
                    ("ì‹ ì‚¬ë™", "1141010300"),
                    ("ì¦ì‚°ë™", "1141010300"),
                    ("ìˆ˜ìƒ‰ë™", "1141010300"),
                    ("ì§„ê´€ë™", "1141010300")
                ],
                "ì„œëŒ€ë¬¸êµ¬": [
                    ("ì¶©ì •ë¡œ2ê°€", "1144010300"),
                    ("ì¶©ì •ë¡œ3ê°€", "1144010300"),
                    ("í•©ë™", "1144010300"),
                    ("ë¯¸ê·¼ë™", "1144010300"),
                    ("ì²œì—°ë™", "1144010300"),
                    ("ì˜¥ì²œë™", "1144010300"),
                    ("ì˜ì²œë™", "1144010300"),
                    ("í˜„ì €ë™", "1144010300"),
                    ("í™ì œë™", "1144010300"),
                    ("í™ì€ë™", "1144010300"),
                    ("ë‚¨ê°€ì¢Œë™", "1144010300"),
                    ("ë¶ê°€ì¢Œë™", "1144010300"),
                    ("ì‹ ì´Œë™", "1144010300"),
                    ("ì—°í¬ë™", "1144010300"),
                    ("ì„±ì‚°ë™", "1144010300")
                ],
                "ê°•ì„œêµ¬": [
                    ("ì—¼ì°½ë™", "1150010300"),
                    ("ë“±ì´Œë™", "1150010300"),
                    ("í™”ê³¡ë™", "1150010300"),
                    ("ê°€ì–‘ë™", "1150010300"),
                    ("ë§ˆê³¡ë™", "1150010300"),
                    ("ë‚´ë°œì‚°ë™", "1150010300"),
                    ("ì™¸ë°œì‚°ë™", "1150010300"),
                    ("ê³µí•­ë™", "1150010300"),
                    ("ë°©í™”ë™", "1150010300")
                ],
                "êµ¬ë¡œêµ¬": [
                    ("ì‹ ë„ë¦¼ë™", "1153010300"),
                    ("êµ¬ë¡œë™", "1153010300"),
                    ("ê°€ë¦¬ë´‰ë™", "1153010300"),
                    ("ê³ ì²™ë™", "1153010300"),
                    ("ê°œë´‰ë™", "1153010300"),
                    ("ì˜¤ë¥˜ë™", "1153010300"),
                    ("ì˜¨ìˆ˜ë™", "1153010300")
                ],
                "ê¸ˆì²œêµ¬": [
                    ("ê°€ì‚°ë™", "1154510300"),
                    ("ë…ì‚°ë™", "1154510300"),
                    ("ì‹œí¥ë™", "1154510300")
                ],
                "ì˜ë“±í¬êµ¬": [
                    ("ì˜ë“±í¬ë™", "1156010300"),
                    ("ì—¬ì˜ë„ë™", "1156010300"),
                    ("ë‹¹ì‚°ë™", "1156010300"),
                    ("ë„ë¦¼ë™", "1156010300"),
                    ("ë¬¸ë˜ë™", "1156010300"),
                    ("ì–‘í‰ë™", "1156010300"),
                    ("ì‹ ê¸¸ë™", "1156010300"),
                    ("ëŒ€ë¦¼ë™", "1156010300")
                ],
                "ë™ì‘êµ¬": [
                    ("ë…¸ëŸ‰ì§„ë™", "1159010300"),
                    ("ìƒë„ë™", "1159010300"),
                    ("ìƒë„1ë™", "1159010300"),
                    ("ë³¸ë™", "1159010300"),
                    ("í‘ì„ë™", "1159010300"),
                    ("ë™ì‘ë™", "1159010300"),
                    ("ì‚¬ë‹¹ë™", "1159010300"),
                    ("ëŒ€ë°©ë™", "1159010300"),
                    ("ì‹ ëŒ€ë°©ë™", "1159010300")
                ],
                "ê´€ì•…êµ¬": [
                    ("ë³´ë¼ë§¤ë™", "1162010300"),
                    ("ì²­ë¦¼ë™", "1162010300"),
                    ("í–‰ìš´ë™", "1162010300"),
                    ("ë‚™ì„±ëŒ€ë™", "1162010300"),
                    ("ì²­ë£¡ë™", "1162010300"),
                    ("ì€ì²œë™", "1162010300"),
                    ("ì„±í˜„ë™", "1162010300"),
                    ("ì¤‘ì•™ë™", "1162010300"),
                    ("ì¸í—Œë™", "1162010300"),
                    ("ë‚¨í˜„ë™", "1162010300"),
                    ("ë¬¸ì„±ë™", "1162010300"),
                    ("ì‹ ì‚¬ë™", "1162010300"),
                    ("ì‹ ë¦¼ë™", "1162010300"),
                    ("ì„œì›ë™", "1162010300"),
                    ("ì„œë¦¼ë™", "1162010300"),
                    ("ì‚¼ì„±ë™", "1162010300"),
                    ("ë¯¸ì„±ë™", "1162010300"),
                    ("ë‚œê³¡ë™", "1162010300"),
                    ("ë‚œí–¥ë™", "1162010300"),
                    ("ì¡°ì›ë™", "1162010300")
                ],
                "ì–‘ì²œêµ¬": [
                    ("ëª©ë™", "1165010300"),
                    ("ì‹ ì›”ë™", "1165010300"),
                    ("ì‹ ì •ë™", "1165010300")
                ]
            },
            "ê²½ê¸°": {
                "ìˆ˜ì›ì‹œ ì˜í†µêµ¬": [
                    ("ë§¤íƒ„ë™", "4111730000"),
                    ("ì›ì²œë™", "4111730000"),
                    ("ì˜í†µë™", "4111730000"),
                    ("í•˜ë™", "4111730000"),
                    ("ê´‘êµë™", "4111730000")
                ],
                "ìˆ˜ì›ì‹œ ì¥ì•ˆêµ¬": [
                    ("íŒŒì¥ë™", "4111710000"),
                    ("ìœ¨ì „ë™", "4111710000"),
                    ("ì •ìë™", "4111710000"),
                    ("ì†¡ì£½ë™", "4111710000"),
                    ("ì¡°ì›ë™", "4111710000")
                ],
                "ì„±ë‚¨ì‹œ ë¶„ë‹¹êµ¬": [
                    ("ì •ìë™", "4113520000"),
                    ("ìˆ˜ë‚´ë™", "4113520000"),
                    ("ì„œí˜„ë™", "4113520000"),
                    ("ì´ë§¤ë™", "4113520000"),
                    ("ì•¼íƒ‘ë™", "4113520000"),
                    ("ì‚¼í‰ë™", "4113520000"),
                    ("ìš´ì¤‘ë™", "4113520000"),
                    ("ê¸ˆê³¡ë™", "4113520000"),
                    ("êµ¬ë¯¸ë™", "4113520000"),
                    ("ë°±í˜„ë™", "4113520000")
                ],
                "ì„±ë‚¨ì‹œ ìˆ˜ì •êµ¬": [
                    ("ìˆ˜ì§„ë™", "4113510000"),
                    ("ì‹ í¥ë™", "4113510000"),
                    ("íƒœí‰ë™", "4113510000"),
                    ("ë‹¨ëŒ€ë™", "4113510000"),
                    ("ë³µì •ë™", "4113510000")
                ],
                "ê³ ì–‘ì‹œ ì¼ì‚°ë™êµ¬": [
                    ("ë°±ì„ë™", "4128130000"),
                    ("ë§ˆë‘ë™", "4128130000"),
                    ("ì¥í•­ë™", "4128130000"),
                    ("í’ë™", "4128130000"),
                    ("ì‹ì‚¬ë™", "4128130000")
                ],
                "ê³ ì–‘ì‹œ ì¼ì‚°ì„œêµ¬": [
                    ("ì£¼ì—½ë™", "4128120000"),
                    ("ëŒ€í™”ë™", "4128120000"),
                    ("í‚¨í…ìŠ¤", "4128120000"),
                    ("íƒ„í˜„ë™", "4128120000"),
                    ("ì¼ì‚°ë™", "4128120000")
                ],
                "ìš©ì¸ì‹œ ê¸°í¥êµ¬": [
                    ("ê¸°í¥ë™", "4146720000"),
                    ("ì„œë†ë™", "4146720000"),
                    ("êµ¬ê°ˆë™", "4146720000"),
                    ("ë³´ì •ë™", "4146720000"),
                    ("ìƒê°ˆë™", "4146720000"),
                    ("ì‹ ê°ˆë™", "4146720000")
                ],
                "ìš©ì¸ì‹œ ìˆ˜ì§€êµ¬": [
                    ("ìˆ˜ì§€ë™", "4146730000"),
                    ("ìƒí˜„ë™", "4146730000"),
                    ("ë™ì²œë™", "4146730000"),
                    ("ì„±ë³µë™", "4146730000"),
                    ("í’ë•ì²œë™", "4146730000")
                ],
                "ì•ˆì–‘ì‹œ ë§Œì•ˆêµ¬": [
                    ("ì•ˆì–‘ë™", "4117310000"),
                    ("ë°•ë‹¬ë™", "4117310000"),
                    ("ì„ìˆ˜ë™", "4117310000")
                ],
                "ì•ˆì–‘ì‹œ ë™ì•ˆêµ¬": [
                    ("ë¹„ì‚°ë™", "4117320000"),
                    ("ê´€ì–‘ë™", "4117320000"),
                    ("í‰ì´Œë™", "4117320000"),
                    ("í˜¸ê³„ë™", "4117320000")
                ]
            },
            "ë¶€ì‚°": {
                "í•´ìš´ëŒ€êµ¬": [
                    ("ìš°ë™", "2644010100"),
                    ("ì¤‘ë™", "2644010100"),
                    ("ì¢Œë™", "2644010100"),
                    ("ì†¡ì •ë™", "2644010100"),
                    ("ë°˜ì—¬ë™", "2644010100"),
                    ("ë°˜ì†¡ë™", "2644010100"),
                    ("ì¬ì†¡ë™", "2644010100")
                ],
                "ìˆ˜ì˜êµ¬": [
                    ("ë‚¨ì²œë™", "2644010200"),
                    ("ë¯¼ë½ë™", "2644010200"),
                    ("ìˆ˜ì˜ë™", "2644010200"),
                    ("ë§ë¯¸ë™", "2644010200"),
                    ("ê´‘ì•ˆë™", "2644010200")
                ],
                "ë¶€ì‚°ì§„êµ¬": [
                    ("ë¶€ì „ë™", "2641510000"),
                    ("ì—°ì§€ë™", "2641510000"),
                    ("ì´ˆìë™", "2641510000"),
                    ("ì–‘ì •ë™", "2641510000"),
                    ("ì „í¬ë™", "2641510000"),
                    ("ì„œë©´", "2641510000")
                ],
                "ë™ë˜êµ¬": [
                    ("ì˜¨ì²œë™", "2641710000"),
                    ("ì‚¬ì§ë™", "2641710000"),
                    ("ì•ˆë½ë™", "2641710000"),
                    ("ëª…ë¥œë™", "2641710000"),
                    ("ë³µì²œë™", "2641710000")
                ],
                "ë‚¨êµ¬": [
                    ("ëŒ€ì—°ë™", "2641410000"),
                    ("ìš©í˜¸ë™", "2641410000"),
                    ("ë¬¸í˜„ë™", "2641410000"),
                    ("ê°ë§Œë™", "2641410000")
                ],
                "ì„œêµ¬": [
                    ("ì„œëŒ€ì‹ ë™", "2641110000"),
                    ("ë™ëŒ€ì‹ ë™", "2641110000"),
                    ("ë¶€ë¯¼ë™", "2641110000"),
                    ("ì•„ë¯¸ë™", "2641110000"),
                    ("ì¶©ë¬´ë™", "2641110000")
                ]
            },
            "ëŒ€êµ¬": {
                "ìˆ˜ì„±êµ¬": [
                    ("ë²”ì–´ë™", "2741710000"),
                    ("ë§Œì´Œë™", "2741710000"),
                    ("ìˆ˜ì„±ë™", "2741710000"),
                    ("ì§€ì‚°ë™", "2741710000"),
                    ("í™©ê¸ˆë™", "2741710000"),
                    ("ì¤‘ë™", "2741710000"),
                    ("ìƒë™", "2741710000"),
                    ("íŒŒë™", "2741710000")
                ],
                "ë‹¬ì„œêµ¬": [
                    ("ì´ê³¡ë™", "2741910000"),
                    ("ìš©ì‚°ë™", "2741910000"),
                    ("ì„±ì„œë™", "2741910000"),
                    ("ë³¸ë¦¬ë™", "2741910000"),
                    ("ì¥ê¸°ë™", "2741910000"),
                    ("ìƒì¸ë™", "2741910000")
                ],
                "ì¤‘êµ¬": [
                    ("ë™ì¸ë™", "2741110000"),
                    ("ì‚¼ë•ë™", "2741110000"),
                    ("ì„±ë‚´ë™", "2741110000"),
                    ("ëŒ€ì‹ ë™", "2741110000"),
                    ("ë‚¨ì‚°ë™", "2741110000")
                ],
                "ë¶êµ¬": [
                    ("ì‚°ê²©ë™", "2741310000"),
                    ("ë³µí˜„ë™", "2741310000"),
                    ("ê²€ë‹¨ë™", "2741310000"),
                    ("ëŒ€í˜„ë™", "2741310000"),
                    ("ì¹ ì„±ë™", "2741310000")
                ]
            },
            "ì¸ì²œ": {
                "ì—°ìˆ˜êµ¬": [
                    ("ì—°ìˆ˜ë™", "2811010400"),
                    ("ì„ í•™ë™", "2811010400"),
                    ("ì²­í•™ë™", "2811010400"),
                    ("ë™ì¶˜ë™", "2811010400"),
                    ("ì†¡ë„ë™", "2811010400"),
                    ("ì˜¥ë ¨ë™", "2811010400")
                ],
                # 3ë‹¨ê³„ í™•ì¥: ì¸ì²œ ì „ì²´
                "ë‚¨ë™êµ¬": [
                    ("êµ¬ì›”ë™", "2811710000"),
                    ("ê°„ì„ë™", "2811710000"),
                    ("ë§Œìˆ˜ë™", "2811710000"),
                    ("ì„œì°½ë™", "2811710000"),
                    ("ë…¼í˜„ë™", "2811710000")
                ],
                "ë¶€í‰êµ¬": [
                    ("ë¶€í‰ë™", "2811410000"),
                    ("ì‹­ì •ë™", "2811410000"),
                    ("ì¼ì‹ ë™", "2811410000"),
                    ("ì‚¼ì‚°ë™", "2811410000")
                ]
            },
            # 3ë‹¨ê³„ í™•ì¥: ê´‘ì£¼ê´‘ì—­ì‹œ
            "ê´‘ì£¼": {
                "ê´‘ì‚°êµ¬": [
                    ("ì‹ ê°€ë™", "2962010000"),
                    ("ì›”ê³¡ë™", "2962010000"),
                    ("ìˆ˜ì™„ë™", "2962010000"),
                    ("í•˜ë‚¨ë™", "2962010000"),
                    ("ì†¡ì •ë™", "2962010000")
                ],
                "ì„œêµ¬": [
                    ("ì¹˜í‰ë™", "2914010000"),
                    ("ê¸ˆí˜¸ë™", "2914010000"),
                    ("ë†ì„±ë™", "2914010000"),
                    ("ìƒë¬´ë™", "2914010000")
                ]
            },
            # 3ë‹¨ê³„ í™•ì¥: ëŒ€ì „ê´‘ì—­ì‹œ
            "ëŒ€ì „": {
                "ìœ ì„±êµ¬": [
                    ("ë´‰ëª…ë™", "3017310000"),
                    ("êµ¬ì•”ë™", "3017310000"),
                    ("ì „ë¯¼ë™", "3017310000"),
                    ("ì˜¨ì²œë™", "3017310000"),
                    ("ë…¸ì€ë™", "3017310000")
                ],
                "ì„œêµ¬": [
                    ("ë‘”ì‚°ë™", "3017110000"),
                    ("ì›”í‰ë™", "3017110000"),
                    ("ìš©ë¬¸ë™", "3017110000"),
                    ("íƒ„ë°©ë™", "3017110000")
                ]
            },
            # 3ë‹¨ê³„ í™•ì¥: ìš¸ì‚°ê´‘ì—­ì‹œ
            "ìš¸ì‚°": {
                "ë‚¨êµ¬": [
                    ("ì‚¼ì‚°ë™", "3114110000"),
                    ("ë‹¬ë™", "3114110000"),
                    ("ì˜¥ë™", "3114110000"),
                    ("ì•¼ìŒë™", "3114110000")
                ],
                "ë™êµ¬": [
                    ("í™”ì •ë™", "3114210000"),
                    ("ì¼ì‚°ë™", "3114210000"),
                    ("ì „í•˜ë™", "3114210000"),
                    ("ë°©ì–´ë™", "3114210000")
                ]
            },
            # 3ë‹¨ê³„ í™•ì¥: ì„¸ì¢…íŠ¹ë³„ìì¹˜ì‹œ
            "ì„¸ì¢…": {
                "ì„¸ì¢…ì‹œ": [
                    ("ì¡°ì¹˜ì›ì", "3611000000"),
                    ("ì—°ê¸°ë©´", "3611000000"),
                    ("ì—°ë™ë©´", "3611000000"),
                    ("ë¶€ê°•ë©´", "3611000000"),
                    ("ì•„ë¦„ë™", "3611000000"),
                    ("ì¢…ì´Œë™", "3611000000"),
                    ("ê³ ìš´ë™", "3611000000"),
                    ("ë³´ëŒë™", "3611000000")
                ]
            },
            # 3ë‹¨ê³„ í™•ì¥: ì¶©ì²­ë‚¨ë„ ì£¼ìš” ì§€ì—­
            "ì¶©ë‚¨": {
                "ì²œì•ˆì‹œ": [
                    ("ì‹ ë¶€ë™", "4413310000"),
                    ("ë´‰ëª…ë™", "4413310000"),
                    ("ì›ì„±ë™", "4413310000"),
                    ("ì²­ë‹¹ë™", "4413310000"),
                    ("ë‘ì •ë™", "4413320000"),
                    ("ë°±ì„ë™", "4413320000"),
                    ("ìŒìš©ë™", "4413320000")
                ],
                "ì•„ì‚°ì‹œ": [
                    ("ì˜¨ì²œë™", "4415000000"),
                    ("ë°°ë°©ì", "4415000000"),
                    ("íƒ•ì •ë©´", "4415000000"),
                    ("ì‹ ì°½ë©´", "4415000000")
                ]
            },
            # 3ë‹¨ê³„ í™•ì¥: ì „ë¼ë¶ë„ ì£¼ìš” ì§€ì—­
            "ì „ë¶": {
                "ì „ì£¼ì‹œ": [
                    ("íš¨ìë™", "4511110000"),
                    ("ì‚¼ì²œë™", "4511110000"),
                    ("ì¤‘í™”ì‚°ë™", "4511110000"),
                    ("ì„œì‹ ë™", "4511110000"),
                    ("ë•ì§„ë™", "4511120000"),
                    ("ê¸ˆì•”ë™", "4511120000"),
                    ("ì¸í›„ë™", "4511120000"),
                    ("ì†¡ì²œë™", "4511120000")
                ]
            },
            # 3ë‹¨ê³„ í™•ì¥: ê²½ìƒë‚¨ë„ ì£¼ìš” ì§€ì—­  
            "ê²½ë‚¨": {
                "ì°½ì›ì‹œ": [
                    ("íŒ”ìš©ë™", "4812710000"),
                    ("ëª…ê³¡ë™", "4812710000"),
                    ("ìƒë‚¨ë™", "4812720000"),
                    ("ì¤‘ì•™ë™", "4812720000"),
                    ("ì„±ì£¼ë™", "4812720000"),
                    ("ëŒ€ë°©ë™", "4812720000")
                ],
                "ê¹€í•´ì‹œ": [
                    ("ì¥ìœ ë™", "4812500000"),
                    ("ì‚¼ê³„ë™", "4812500000"),
                    ("ë‚´ì™¸ë™", "4812500000"),
                    ("ë¶€ì›ë™", "4812500000")
                ]
            },
            # 3ë‹¨ê³„ í™•ì¥: ê°•ì›ë„ ì£¼ìš” ì§€ì—­
            "ê°•ì›": {
                "ì¶˜ì²œì‹œ": [
                    ("íš¨ìë™", "4211100000"),
                    ("ì„ì‚¬ë™", "4211100000"),
                    ("ì˜¨ì˜ë™", "4211100000"),
                    ("ê·¼í™”ë™", "4211100000")
                ],
                "ì›ì£¼ì‹œ": [
                    ("ë‹¨ê³„ë™", "4211300000"),
                    ("ë¬´ì‹¤ë™", "4211300000"),
                    ("íƒœì¥ë™", "4211300000"),
                    ("ë°˜ê³¡ë™", "4211300000")
                ]
            }
        }

    def get_dong_coordinates(self, city: str, gu: str, dong: str) -> Tuple[float, float, float, float]:
        """ë™ë‹¨ìœ„ ìƒì„¸ ì¢Œí‘œ ê³„ì‚°"""
        # ê¸°ë³¸ ì¢Œí‘œ ë§µí•‘ (ì‹¤ì œë¡œëŠ” ë” ì •í™•í•œ ì¢Œí‘œ ì‚¬ìš©)
        base_coords = {
            # ì„œìš¸ ê°•ë‚¨êµ¬
            "ì„œìš¸_ê°•ë‚¨êµ¬_ì‹ ì‚¬ë™": (127.020, 127.030, 37.525, 37.515),
            "ì„œìš¸_ê°•ë‚¨êµ¬_ë…¼í˜„ë™": (127.025, 127.035, 37.515, 37.505),
            "ì„œìš¸_ê°•ë‚¨êµ¬_ì••êµ¬ì •ë™": (127.025, 127.035, 37.530, 37.520),
            "ì„œìš¸_ê°•ë‚¨êµ¬_ì²­ë‹´ë™": (127.040, 127.050, 37.525, 37.515),
            "ì„œìš¸_ê°•ë‚¨êµ¬_ì‚¼ì„±ë™": (127.050, 127.060, 37.515, 37.505),
            "ì„œìš¸_ê°•ë‚¨êµ¬_ëŒ€ì¹˜ë™": (127.055, 127.065, 37.505, 37.495),
            "ì„œìš¸_ê°•ë‚¨êµ¬_ì—­ì‚¼ë™": (127.030, 127.040, 37.505, 37.495),
            "ì„œìš¸_ê°•ë‚¨êµ¬_ë„ê³¡ë™": (127.040, 127.050, 37.495, 37.485),
            "ì„œìš¸_ê°•ë‚¨êµ¬_ê°œí¬ë™": (127.055, 127.065, 37.485, 37.475),
            
            # ì„œìš¸ ì„œì´ˆêµ¬
            "ì„œìš¸_ì„œì´ˆêµ¬_ë°©ë°°ë™": (126.995, 127.015, 37.485, 37.475),
            "ì„œìš¸_ì„œì´ˆêµ¬_ì„œì´ˆë™": (127.015, 127.035, 37.495, 37.485),
            "ì„œìš¸_ì„œì´ˆêµ¬_ë°˜í¬ë™": (126.995, 127.015, 37.515, 37.505),
            "ì„œìš¸_ì„œì´ˆêµ¬_ì ì›ë™": (127.015, 127.035, 37.525, 37.515),
            
            # 3ë‹¨ê³„ í™•ì¥ ì¢Œí‘œ: ê´‘ì£¼ê´‘ì—­ì‹œ
            "ê´‘ì£¼_ê´‘ì‚°êµ¬_ì‹ ê°€ë™": (126.785, 126.795, 35.220, 35.210),
            "ê´‘ì£¼_ê´‘ì‚°êµ¬_ì›”ê³¡ë™": (126.790, 126.800, 35.215, 35.205),
            "ê´‘ì£¼_ê´‘ì‚°êµ¬_ìˆ˜ì™„ë™": (126.820, 126.830, 35.210, 35.200),
            "ê´‘ì£¼_ì„œêµ¬_ì¹˜í‰ë™": (126.885, 126.895, 35.155, 35.145),
            "ê´‘ì£¼_ì„œêµ¬_ê¸ˆí˜¸ë™": (126.890, 126.900, 35.150, 35.140),
            "ê´‘ì£¼_ì„œêµ¬_ë†ì„±ë™": (126.895, 126.905, 35.145, 35.135),
            
            # 3ë‹¨ê³„ í™•ì¥ ì¢Œí‘œ: ëŒ€ì „ê´‘ì—­ì‹œ
            "ëŒ€ì „_ìœ ì„±êµ¬_ë´‰ëª…ë™": (127.335, 127.345, 36.360, 36.350),
            "ëŒ€ì „_ìœ ì„±êµ¬_êµ¬ì•”ë™": (127.340, 127.350, 36.355, 36.345),
            "ëŒ€ì „_ìœ ì„±êµ¬_ì „ë¯¼ë™": (127.345, 127.355, 36.350, 36.340),
            "ëŒ€ì „_ì„œêµ¬_ë‘”ì‚°ë™": (127.380, 127.390, 36.350, 36.340),
            "ëŒ€ì „_ì„œêµ¬_ì›”í‰ë™": (127.375, 127.385, 36.345, 36.335),
            "ëŒ€ì „_ì„œêµ¬_ìš©ë¬¸ë™": (127.370, 127.380, 36.340, 36.330),
            
            # 3ë‹¨ê³„ í™•ì¥ ì¢Œí‘œ: ìš¸ì‚°ê´‘ì—­ì‹œ
            "ìš¸ì‚°_ë‚¨êµ¬_ì‚¼ì‚°ë™": (129.315, 129.325, 35.540, 35.530),
            "ìš¸ì‚°_ë‚¨êµ¬_ë‹¬ë™": (129.320, 129.330, 35.535, 35.525),
            "ìš¸ì‚°_ë‚¨êµ¬_ì˜¥ë™": (129.325, 129.335, 35.530, 35.520),
            "ìš¸ì‚°_ë™êµ¬_í™”ì •ë™": (129.420, 129.430, 35.515, 35.505),
            "ìš¸ì‚°_ë™êµ¬_ì¼ì‚°ë™": (129.425, 129.435, 35.510, 35.500),
            
            # 3ë‹¨ê³„ í™•ì¥ ì¢Œí‘œ: ì„¸ì¢…íŠ¹ë³„ìì¹˜ì‹œ
            "ì„¸ì¢…_ì„¸ì¢…ì‹œ_ì¡°ì¹˜ì›ì": (127.290, 127.300, 36.605, 36.595),
            "ì„¸ì¢…_ì„¸ì¢…ì‹œ_ì•„ë¦„ë™": (127.285, 127.295, 36.600, 36.590),
            "ì„¸ì¢…_ì„¸ì¢…ì‹œ_ì¢…ì´Œë™": (127.280, 127.290, 36.595, 36.585),
            "ì„¸ì¢…_ì„¸ì¢…ì‹œ_ê³ ìš´ë™": (127.275, 127.285, 36.590, 36.580),
            
            # 3ë‹¨ê³„ í™•ì¥ ì¢Œí‘œ: ì¸ì²œ ì¶”ê°€ ì§€ì—­
            "ì¸ì²œ_ë‚¨ë™êµ¬_êµ¬ì›”ë™": (126.730, 126.740, 37.455, 37.445),
            "ì¸ì²œ_ë‚¨ë™êµ¬_ê°„ì„ë™": (126.735, 126.745, 37.450, 37.440),
            "ì¸ì²œ_ë‚¨ë™êµ¬_ë§Œìˆ˜ë™": (126.740, 126.750, 37.445, 37.435),
            "ì¸ì²œ_ë¶€í‰êµ¬_ë¶€í‰ë™": (126.720, 126.730, 37.495, 37.485),
            "ì¸ì²œ_ë¶€í‰êµ¬_ì‹­ì •ë™": (126.715, 126.725, 37.490, 37.480),
            
            # 3ë‹¨ê³„ í™•ì¥ ì¢Œí‘œ: ì¶©ì²­ë‚¨ë„
            "ì¶©ë‚¨_ì²œì•ˆì‹œ_ì‹ ë¶€ë™": (127.125, 127.135, 36.815, 36.805),
            "ì¶©ë‚¨_ì²œì•ˆì‹œ_ë´‰ëª…ë™": (127.130, 127.140, 36.810, 36.800),
            "ì¶©ë‚¨_ì²œì•ˆì‹œ_ë‘ì •ë™": (127.120, 127.130, 36.820, 36.810),
            "ì¶©ë‚¨_ì•„ì‚°ì‹œ_ì˜¨ì²œë™": (127.005, 127.015, 36.785, 36.775),
            "ì¶©ë‚¨_ì•„ì‚°ì‹œ_ë°°ë°©ì": (127.000, 127.010, 36.780, 36.770),
            
            # 3ë‹¨ê³„ í™•ì¥ ì¢Œí‘œ: ì „ë¼ë¶ë„
            "ì „ë¶_ì „ì£¼ì‹œ_íš¨ìë™": (127.135, 127.145, 35.825, 35.815),
            "ì „ë¶_ì „ì£¼ì‹œ_ì‚¼ì²œë™": (127.140, 127.150, 35.820, 35.810),
            "ì „ë¶_ì „ì£¼ì‹œ_ë•ì§„ë™": (127.145, 127.155, 35.815, 35.805),
            "ì „ë¶_ì „ì£¼ì‹œ_ê¸ˆì•”ë™": (127.150, 127.160, 35.810, 35.800),
            
            # 3ë‹¨ê³„ í™•ì¥ ì¢Œí‘œ: ê²½ìƒë‚¨ë„
            "ê²½ë‚¨_ì°½ì›ì‹œ_íŒ”ìš©ë™": (128.680, 128.690, 35.225, 35.215),
            "ê²½ë‚¨_ì°½ì›ì‹œ_ìƒë‚¨ë™": (128.685, 128.695, 35.220, 35.210),
            "ê²½ë‚¨_ì°½ì›ì‹œ_ì„±ì£¼ë™": (128.690, 128.700, 35.215, 35.205),
            "ê²½ë‚¨_ê¹€í•´ì‹œ_ì¥ìœ ë™": (128.805, 128.815, 35.180, 35.170),
            "ê²½ë‚¨_ê¹€í•´ì‹œ_ì‚¼ê³„ë™": (128.810, 128.820, 35.175, 35.165),
            
            # 3ë‹¨ê³„ í™•ì¥ ì¢Œí‘œ: ê°•ì›ë„
            "ê°•ì›_ì¶˜ì²œì‹œ_íš¨ìë™": (127.735, 127.745, 37.875, 37.865),
            "ê°•ì›_ì¶˜ì²œì‹œ_ì„ì‚¬ë™": (127.740, 127.750, 37.870, 37.860),
            "ê°•ì›_ì›ì£¼ì‹œ_ë‹¨ê³„ë™": (127.945, 127.955, 37.345, 37.335),
            "ê°•ì›_ì›ì£¼ì‹œ_ë¬´ì‹¤ë™": (127.950, 127.960, 37.340, 37.330),
            
            # ê¸°ë³¸ê°’
            "default": (127.000, 127.020, 37.500, 37.480)
        }
        
        key = f"{city}_{gu}_{dong}"
        return base_coords.get(key, base_coords["default"])

    def get_trade_types(self) -> List[str]:
        """ê±°ë˜ íƒ€ì… ëª©ë¡"""
        return ["ë§¤ë§¤", "ì „ì„¸", "ì›”ì„¸"]

    def get_trade_type_code(self, trade_type: str) -> str:
        """ê±°ë˜ íƒ€ì… ì½”ë“œ ë³€í™˜"""
        codes = {
            "ë§¤ë§¤": "A1",
            "ì „ì„¸": "B1", 
            "ì›”ì„¸": "B2"
        }
        return codes.get(trade_type, "A1")

    async def crawl_dong_trade_type(self, city: str, gu: str, dong: str, region_code: str, trade_type: str) -> int:
        """íŠ¹ì • ë™ì˜ íŠ¹ì • ê±°ë˜íƒ€ì… í¬ë¡¤ë§"""
        coords = self.get_dong_coordinates(city, gu, dong)
        trade_code = self.get_trade_type_code(trade_type)
        
        # ì´ë¯¸ ì™„ë£Œëœ ê²½ìš° ìŠ¤í‚µ
        conn = sqlite3.connect(self.db_path)
        cursor = conn.cursor()
        cursor.execute("""
            SELECT status FROM crawling_progress 
            WHERE city = ? AND gu = ? AND dong = ? AND trade_type = ? AND status = 'completed'
        """, (city, gu, dong, trade_type))
        
        if cursor.fetchone():
            conn.close()
            logger.info(f"â­ï¸ {city} {gu} {dong} {trade_type}: ì´ë¯¸ ì™„ë£Œë¨")
            return 0
        conn.close()
        
        # ì§„í–‰ ìƒí™© ê¸°ë¡
        conn = sqlite3.connect(self.db_path)
        cursor = conn.cursor()
        cursor.execute("""
            INSERT OR REPLACE INTO crawling_progress 
            (city, gu, dong, trade_type, status, crawl_start_time, retry_count)
            VALUES (?, ?, ?, ?, ?, ?, 0)
        """, (city, gu, dong, trade_type, 'processing', datetime.now()))
        conn.commit()
        progress_id = cursor.lastrowid
        conn.close()
        
        try:
            # API íŒŒë¼ë¯¸í„° êµ¬ì„±
            left_lon, right_lon, top_lat, bottom_lat = coords
            
            params = {
                'cortarNo': region_code,
                'zoom': '17',  # ë§¤ìš° ë†’ì€ ì¤Œ ë ˆë²¨
                'priceType': 'RETAIL',
                'markerId': '',
                'markerType': '',
                'selectedComplexNo': '',
                'selectedComplexBuildingNo': '',
                'fakeComplexMarker': '',
                'realEstateType': 'APT:ABYG:JGC:PRE',
                'tradeType': trade_code,
                'tag': '::::::::',
                'rentPriceMin': '0',
                'rentPriceMax': '999999999',
                'priceMin': '0',
                'priceMax': '999999999',
                'areaMin': '0',
                'areaMax': '999999999',
                'oldBuildYears': '99',
                'recentlyBuildYears': '0',
                'minHouseHoldCount': '',
                'maxHouseHoldCount': '',
                'showArticle': 'false',
                'sameAddressGroup': 'false',
                'minMaintenanceCost': '',
                'maxMaintenanceCost': '',
                'directions': '',
                'leftLon': str(left_lon),
                'rightLon': str(right_lon),
                'topLat': str(top_lat),
                'bottomLat': str(bottom_lat),
                'isPresale': 'true'
            }
            
            url = f"{self.base_url}?{urlencode(params)}"
            logger.info(f"ğŸ” API í˜¸ì¶œ: {city} {gu} {dong} {trade_type}")
            
            # API í˜¸ì¶œ + ì°¨ë‹¨ ê°ì§€ ë° VPN ì „í™˜
            async with self.session.get(url) as response:
                if response.status == 200:
                    data = await response.json()
                    
                    if isinstance(data, list):
                        count = self.save_apartments(data, city, gu, dong, trade_type)
                        
                        # ì„±ê³µ ê¸°ë¡
                        conn = sqlite3.connect(self.db_path)
                        cursor = conn.cursor()
                        cursor.execute("""
                            UPDATE crawling_progress 
                            SET status = ?, apartment_count = ?, crawl_end_time = ?
                            WHERE id = ?
                        """, ('completed', count, datetime.now(), progress_id))
                        conn.commit()
                        conn.close()
                        
                        # ì„±ê³µ ì‹œ ì°¨ë‹¨ ì¹´ìš´íŠ¸ ë¦¬ì…‹
                        self.blocked_count = 0
                        logger.info(f"âœ… {city} {gu} {dong} {trade_type}: {count}ê°œ ìˆ˜ì§‘")
                        return count
                    else:
                        logger.warning(f"âš ï¸ {city} {gu} {dong} {trade_type}: ì˜ˆìƒê³¼ ë‹¤ë¥¸ ì‘ë‹µ")
                        return 0
                        
                elif response.status in [403, 429, 503]:  # ì°¨ë‹¨ ì˜ì‹¬ ìƒíƒœ ì½”ë“œ
                    logger.warning(f"ğŸš¨ {city} {gu} {dong} {trade_type}: ì°¨ë‹¨ ì˜ì‹¬ HTTP {response.status}")
                    
                    # VPN ì „í™˜ ì‹œë„
                    if VPN_AVAILABLE and self.vpn_manager:
                        success = await self.handle_blocking_detection(f"HTTP {response.status}")
                        if success:
                            logger.info("ğŸ”„ VPN ì „í™˜ í›„ ì¬ì‹œë„")
                            # ì¬ì‹œë„ ë¡œì§ì€ ìƒìœ„ í•¨ìˆ˜ì—ì„œ ì²˜ë¦¬í•˜ë„ë¡ Exception ë°œìƒ
                            raise Exception(f"VPN_SWITCH_RETRY_{response.status}")
                    
                    return 0
                else:
                    logger.warning(f"âš ï¸ {city} {gu} {dong} {trade_type}: HTTP {response.status}")
                    return 0
                    
        except Exception as e:
            error_message = str(e)
            
            # VPN ì „í™˜ ì¬ì‹œë„ì¸ ê²½ìš°
            if "VPN_SWITCH_RETRY" in error_message:
                logger.info(f"ğŸ”„ VPN ì „í™˜ í›„ {city} {gu} {dong} {trade_type} ì¬ì‹œë„")
                
                # ì¬ì‹œë„ ë”œë ˆì´
                await asyncio.sleep(random.uniform(5, 10))
                
                # ì¬ê·€ í˜¸ì¶œë¡œ ì¬ì‹œë„ (ìµœëŒ€ 3íšŒ)
                if hasattr(self, '_retry_count'):
                    self._retry_count += 1
                else:
                    self._retry_count = 1
                    
                if self._retry_count <= 3:
                    logger.info(f"ğŸ“¡ ì¬ì‹œë„ {self._retry_count}/3: {city} {gu} {dong} {trade_type}")
                    result = await self.crawl_dong_trade_type(city, gu, dong, region_code, trade_type)
                    self._retry_count = 0  # ì„±ê³µ ì‹œ ì¹´ìš´íŠ¸ ë¦¬ì…‹
                    return result
                else:
                    logger.error(f"âŒ ìµœëŒ€ ì¬ì‹œë„ íšŸìˆ˜ ì´ˆê³¼: {city} {gu} {dong} {trade_type}")
                    self._retry_count = 0
            
            # ì‹¤íŒ¨ ê¸°ë¡
            conn = sqlite3.connect(self.db_path)
            cursor = conn.cursor()
            cursor.execute("""
                UPDATE crawling_progress
                SET status = ?, error_message = ?, crawl_end_time = ?
                WHERE id = ?
            """, ('failed', error_message, datetime.now(), progress_id))
            conn.commit()
            conn.close()
            
            logger.error(f"âŒ {city} {gu} {dong} {trade_type}: {error_message}")
            return 0

    def save_apartments(self, apartments_data: List[Dict], city: str, gu: str, dong: str, trade_type: str) -> int:
        """ì•„íŒŒíŠ¸ ë°ì´í„° ì €ì¥ (ì¤‘ë³µ ì œê±° ë° ì—…ë°ì´íŠ¸)"""
        if not apartments_data:
            return 0
            
        conn = sqlite3.connect(self.db_path)
        cursor = conn.cursor()
        
        saved_count = 0
        
        for item in apartments_data:
            try:
                complex_id = str(item.get('markerId', ''))
                if not complex_id:
                    continue
                
                # ì¤‘ë³µ í™•ì¸
                cursor.execute("""
                    SELECT id, trade_types FROM apartment_complexes WHERE complex_id = ?
                """, (complex_id,))
                
                existing = cursor.fetchone()
                
                if existing:
                    # ê¸°ì¡´ ë°ì´í„° ì—…ë°ì´íŠ¸
                    existing_id, existing_trade_types = existing
                    trade_types_list = existing_trade_types.split(',') if existing_trade_types else []
                    
                    if trade_type not in trade_types_list:
                        trade_types_list.append(trade_type)
                    
                    # ê±°ë˜ íƒ€ì…ë³„ ê°€ê²© ì •ë³´ ì—…ë°ì´íŠ¸
                    update_fields = ['trade_types = ?', 'updated_at = ?']
                    update_values = [','.join(trade_types_list), datetime.now()]
                    
                    if trade_type == "ë§¤ë§¤":
                        update_fields.extend(['deal_min_price = ?', 'deal_max_price = ?', 'deal_count = ?'])
                        update_values.extend([
                            item.get('minDealPrice'),
                            item.get('maxDealPrice'), 
                            item.get('dealCount', 0)
                        ])
                    elif trade_type == "ì „ì„¸":
                        update_fields.extend(['lease_min_price = ?', 'lease_max_price = ?', 'lease_count = ?'])
                        update_values.extend([
                            item.get('minLeasePrice'),
                            item.get('maxLeasePrice'),
                            item.get('leaseCount', 0)
                        ])
                    elif trade_type == "ì›”ì„¸":
                        update_fields.extend(['rent_min_price = ?', 'rent_max_price = ?', 'rent_count = ?'])
                        update_values.extend([
                            item.get('minRentPrice'),
                            item.get('maxRentPrice'),
                            item.get('rentCount', 0)
                        ])
                    
                    update_values.append(complex_id)
                    
                    cursor.execute(f"""
                        UPDATE apartment_complexes 
                        SET {', '.join(update_fields)}
                        WHERE complex_id = ?
                    """, update_values)
                    
                else:
                    # ìƒˆ ë°ì´í„° ì‚½ì…
                    deal_min = deal_max = deal_count = None
                    lease_min = lease_max = lease_count = None  
                    rent_min = rent_max = rent_count = None
                    
                    if trade_type == "ë§¤ë§¤":
                        deal_min = item.get('minDealPrice')
                        deal_max = item.get('maxDealPrice')
                        deal_count = item.get('dealCount', 0)
                    elif trade_type == "ì „ì„¸":
                        lease_min = item.get('minLeasePrice')
                        lease_max = item.get('maxLeasePrice')
                        lease_count = item.get('leaseCount', 0)
                    elif trade_type == "ì›”ì„¸":
                        rent_min = item.get('minRentPrice')
                        rent_max = item.get('maxRentPrice')
                        rent_count = item.get('rentCount', 0)
                    
                    cursor.execute("""
                        INSERT INTO apartment_complexes (
                            complex_id, complex_name, city, gu, dong,
                            address_road, address_jibun, latitude, longitude,
                            total_units, construction_year,
                            deal_min_price, deal_max_price, deal_count,
                            lease_min_price, lease_max_price, lease_count,
                            rent_min_price, rent_max_price, rent_count,
                            min_area, max_area, representative_area,
                            real_estate_type, trade_types, raw_data
                        ) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)
                    """, (
                        complex_id,
                        item.get('complexName'),
                        city,
                        gu, 
                        dong,
                        f"{city} {gu} {dong}",
                        f"{city} {gu} {dong}",
                        item.get('latitude'),
                        item.get('longitude'),
                        item.get('totalHouseholdCount'),
                        self.extract_construction_year(item.get('completionYearMonth')),
                        deal_min, deal_max, deal_count,
                        lease_min, lease_max, lease_count,
                        rent_min, rent_max, rent_count,
                        item.get('minArea'),
                        item.get('maxArea'),
                        item.get('representativeArea'),
                        item.get('realEstateTypeName'),
                        trade_type,
                        json.dumps(item, ensure_ascii=False)
                    ))
                
                saved_count += 1
                
            except Exception as e:
                logger.error(f"ë°ì´í„° ì €ì¥ ì˜¤ë¥˜: {e}")
                continue
        
        conn.commit()
        conn.close()
        
        return saved_count

    async def handle_blocking_detection(self, content: str = "") -> bool:
        """ì°¨ë‹¨ ê°ì§€ ì‹œ VPN ì „í™˜ ì²˜ë¦¬"""
        if not VPN_AVAILABLE or not self.vpn_manager:
            logger.warning("âš ï¸ VPN ì‹œìŠ¤í…œì„ ì‚¬ìš©í•  ìˆ˜ ì—†ì–´ ì°¨ë‹¨ ëŒ€ì‘ ë¶ˆê°€")
            return False
            
        try:
            self.blocked_count += 1
            logger.warning(f"ğŸš¨ ì°¨ë‹¨ ê°ì§€ ({self.blocked_count}/{self.max_blocked_attempts}): {content}")
            
            # ìµœëŒ€ ì°¨ë‹¨ íšŸìˆ˜ ì´ˆê³¼ ì‹œ ì¤‘ë‹¨
            if self.blocked_count >= self.max_blocked_attempts:
                logger.error(f"âŒ ìµœëŒ€ ì°¨ë‹¨ íšŸìˆ˜ ì´ˆê³¼. í¬ë¡¤ë§ ì¤‘ë‹¨")
                return False
                
            # VPN ì „í™˜ ì‹œë„
            logger.info("ğŸ”„ VPN ì „í™˜ ì‹œë„ ì¤‘...")
            success, new_ip, new_vpn_type = await handle_ip_blocked(content)
            
            if success:
                logger.info(f"âœ… VPN ì „í™˜ ì„±ê³µ: {self.current_vpn} â†’ {new_vpn_type} (IP: {new_ip})")
                self.current_vpn = new_vpn_type
                self.current_ip = new_ip
                
                # ì„¸ì…˜ ì¬ìƒì„±
                if self.session:
                    await self.session.close()
                    await asyncio.sleep(2)
                
                # ìƒˆ ì„¸ì…˜ ì´ˆê¸°í™” (í—¤ë” ë§Œ ìƒˆë¡œ ì„¤ì •)
                headers = {
                    'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/120.0.0.0 Safari/537.36',
                    'Accept': 'application/json, text/plain, */*',
                    'Accept-Language': 'ko-KR,ko;q=0.9,en;q=0.8',
                    'Referer': 'https://new.land.naver.com/',
                    'Origin': 'https://new.land.naver.com',
                    'Accept-Encoding': 'gzip, deflate, br',
                    'Connection': 'keep-alive',
                    'Sec-Fetch-Dest': 'empty',
                    'Sec-Fetch-Mode': 'cors',
                    'Sec-Fetch-Site': 'same-origin',
                    'Cache-Control': 'no-cache',
                    'Pragma': 'no-cache'
                }
                
                timeout = aiohttp.ClientTimeout(total=60)
                self.session = aiohttp.ClientSession(headers=headers, timeout=timeout)
                
                logger.info("âœ… ìƒˆ ì„¸ì…˜ìœ¼ë¡œ ì¤€ë¹„ ì™„ë£Œ")
                return True
            else:
                logger.error(f"âŒ VPN ì „í™˜ ì‹¤íŒ¨: {new_ip}")
                return False
                
        except Exception as e:
            logger.error(f"âŒ VPN ì „í™˜ ì˜¤ë¥˜: {e}")
            return False

    def extract_construction_year(self, year_month: str) -> Optional[int]:
        """ê±´ì¶•ë…„ì›”ì—ì„œ ë…„ë„ ì¶”ì¶œ"""
        if not year_month:
            return None
        try:
            if len(str(year_month)) >= 4:
                return int(str(year_month)[:4])
        except:
            pass
        return None

    async def crawl_nationwide(self):
        """ì „êµ­ ë™ë‹¨ìœ„ í¬ë¡¤ë§"""
        logger.info("ğŸš€ ì „êµ­ ë™ë‹¨ìœ„ í¬ë¡¤ë§ ì‹œì‘!")
        
        await self.init_session()
        
        # í˜„ì¬ VPN ìƒíƒœ ë¡œê¹…
        if hasattr(self, 'current_vpn') and hasattr(self, 'current_ip'):
            logger.info(f"ğŸ” í˜„ì¬ ì—°ê²° ìƒíƒœ: {self.current_vpn} (IP: {self.current_ip})")
        else:
            logger.info("ğŸ” ì—°ê²° ìƒíƒœ: ì¼ë°˜ ì¸í„°ë„· ì—°ê²°")
        
        try:
            regions = self.get_nationwide_regions()
            total_count = 0
            
            for city, gus in regions.items():
                logger.info(f"ğŸ™ï¸ {city} í¬ë¡¤ë§ ì‹œì‘")
                
                for gu, dongs in gus.items():
                    logger.info(f"ğŸ“ {city} {gu} í¬ë¡¤ë§ ì‹œì‘")
                    
                    for dong, region_code in dongs:
                        logger.info(f"ğŸ˜ï¸ {city} {gu} {dong} í¬ë¡¤ë§ ì‹œì‘")
                        
                        dong_count = 0
                        
                        for trade_type in self.get_trade_types():
                            count = await self.crawl_dong_trade_type(city, gu, dong, region_code, trade_type)
                            dong_count += count
                            
                            # ê±°ë˜ íƒ€ì… ê°„ ë”œë ˆì´ + VPN ìƒíƒœ í‘œì‹œ
                            delay = random.uniform(8, 12)
                            vpn_status = f"[{self.current_vpn}]" if hasattr(self, 'current_vpn') and self.current_vpn != "None" else ""
                            logger.info(f"â³ {vpn_status} ë‹¤ìŒ ê±°ë˜ íƒ€ì…ê¹Œì§€ {delay:.1f}ì´ˆ ëŒ€ê¸°...")
                            await asyncio.sleep(delay)
                        
                        total_count += dong_count
                        logger.info(f"ğŸ¯ {city} {gu} {dong} ì™„ë£Œ: {dong_count}ê°œ ì•„íŒŒíŠ¸")
                        
                        # ë™ ê°„ ë”œë ˆì´ + VPN ìƒíƒœ í‘œì‹œ
                        delay = random.uniform(15, 25)
                        vpn_status = f"[{self.current_vpn}]" if hasattr(self, 'current_vpn') and self.current_vpn != "None" else ""
                        logger.info(f"â³ {vpn_status} ë‹¤ìŒ ë™ê¹Œì§€ {delay:.1f}ì´ˆ ëŒ€ê¸°...")
                        await asyncio.sleep(delay)
                    
                    logger.info(f"âœ… {city} {gu} ì™„ë£Œ")
                    
                logger.info(f"ğŸ‰ {city} ì™„ë£Œ!")
            
            logger.info(f"ğŸ† ì „êµ­ í¬ë¡¤ë§ ì™„ë£Œ! ì´ {total_count}ê°œ ì•„íŒŒíŠ¸ ìˆ˜ì§‘")
            
        finally:
            await self.close_session()

    def generate_progress_report(self):
        """ì§„í–‰ ìƒí™© ë¦¬í¬íŠ¸"""
        conn = sqlite3.connect(self.db_path)
        cursor = conn.cursor()
        
        # ì „ì²´ í†µê³„
        cursor.execute("SELECT COUNT(*) FROM apartment_complexes")
        total_apartments = cursor.fetchone()[0]
        
        # ì§€ì—­ë³„ í†µê³„
        cursor.execute("""
            SELECT city, gu, COUNT(*) as count
            FROM apartment_complexes 
            GROUP BY city, gu 
            ORDER BY city, gu
        """)
        region_stats = cursor.fetchall()
        
        # ê±°ë˜ íƒ€ì…ë³„ í†µê³„
        cursor.execute("""
            SELECT 
                COUNT(CASE WHEN deal_min_price IS NOT NULL THEN 1 END) as deal_count,
                COUNT(CASE WHEN lease_min_price IS NOT NULL THEN 1 END) as lease_count,
                COUNT(CASE WHEN rent_min_price IS NOT NULL THEN 1 END) as rent_count
            FROM apartment_complexes
        """)
        trade_stats = cursor.fetchone()
        
        # ì§„í–‰ ìƒí™©
        cursor.execute("""
            SELECT status, COUNT(*) 
            FROM crawling_progress 
            GROUP BY status
        """)
        progress_stats = cursor.fetchall()
        
        conn.close()
        
        print("\n" + "="*60)
        print("ğŸ“Š ì „êµ­ ë™ë‹¨ìœ„ í¬ë¡¤ë§ ì§„í–‰ ë¦¬í¬íŠ¸")
        print("="*60)
        print(f"ğŸ¢ ì´ ì•„íŒŒíŠ¸ ë‹¨ì§€: {total_apartments:,}ê°œ")
        
        print("\nğŸ—ºï¸ ì§€ì—­ë³„ í˜„í™©:")
        for city, gu, count in region_stats:
            print(f"  {city} {gu}: {count:,}ê°œ")
        
        print("\nğŸ’° ê±°ë˜ íƒ€ì…ë³„ í˜„í™©:")
        if trade_stats:
            print(f"  ë§¤ë§¤: {trade_stats[0]:,}ê°œ")
            print(f"  ì „ì„¸: {trade_stats[1]:,}ê°œ")
            print(f"  ì›”ì„¸: {trade_stats[2]:,}ê°œ")
        
        print("\nâš™ï¸ í¬ë¡¤ë§ ì§„í–‰ ìƒí™©:")
        total_tasks = sum(count for status, count in progress_stats)
        for status, count in progress_stats:
            percentage = (count / total_tasks * 100) if total_tasks > 0 else 0
            print(f"  {status}: {count:,}ê±´ ({percentage:.1f}%)")

async def main():
    """ë©”ì¸ ì‹¤í–‰ í•¨ìˆ˜"""
    print("ğŸš€ ì „êµ­ ë™ë‹¨ìœ„ í¬ë¡¤ë§ ì‹œì‘!")
    print("ğŸ“‹ í¬ë¡¤ë§ ì¡°ê±´:")
    print("  - ëŒ€ìƒ: ì „êµ­ ì£¼ìš” ë„ì‹œ ë™ë‹¨ìœ„")
    print("  - ê±°ë˜íƒ€ì…: ë§¤ë§¤ + ì „ì„¸ + ì›”ì„¸ (ì „ì²´)")
    print("  - ì•„íŒŒíŠ¸íƒ€ì…: ì•„íŒŒíŠ¸ + ë¶„ì–‘ê¶Œ + ì£¼íƒ (ì „ì²´)")
    print("  - ëª¨ë“  ì¡°ê±´: ë¬´ì œí•œ")
    print("  - IP ì°¨ë‹¨ ë°©ì§€: 8-25ì´ˆ ëœë¤ ë”œë ˆì´")
    print("  - DB: ìƒˆë¡œìš´ ìƒì„¸ êµ¬ì¡°")
    
    crawler = NationwideDongCrawler()
    
    start_time = time.time()
    await crawler.crawl_nationwide()
    end_time = time.time()
    
    crawler.generate_progress_report()
    
    print(f"\nâ±ï¸ ì´ ì†Œìš” ì‹œê°„: {(end_time - start_time)/3600:.1f}ì‹œê°„")
    print("ğŸ“ ê²°ê³¼ ì €ì¥: real_estate_crawling.db (ìƒˆë¡œìš´ ìƒì„¸ êµ¬ì¡°)")

if __name__ == "__main__":
    asyncio.run(main())